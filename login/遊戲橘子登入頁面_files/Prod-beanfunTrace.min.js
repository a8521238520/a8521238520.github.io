var sender,beanfunInfo={Url:{GameSyncUrl:"https://alpha-gamesync.beanfun.com"},UserDeviceinformation:{},TrackingSessiondata:{},CookieKey:"beafnunTraceInfo",SendTraceName:""};function Main(){Promise.all([GetMemberProfile_Trace,GetTrackingSessionData,Get_Encrypted_Open_Id]).then(e=>BaseProess()).then(e=>SendPageView("PageView"));var e=document.getElementsByTagName("body")[0];e.addEventListener("click",function(e){EventListenerHandle_Click(e)},{capture:!0}),e.addEventListener("DOMNodeInserted",function(e){EventListenerHandle_NodeInserted(e)})}var TraceParams={LoginStatusModel:{isLoggedIn:!(window.onload=function(){Main()}),openId:""},SwitchSlotModel:{experimentationInfo:[]},BfH5networkInfo:{network:""},BfH5DeviceInfo:{deviceId:"",deviceModel:"",osName:"",osVersion:""},BfH5APPVersion:{appVersion:"",appBuild:""},BfH5PageUrl:{pageUri:""}},TraceEventParams={PageViewEventModel:{eventId:"",event:"",pageInfo:{},isAdditiveView:!0},ClickEventModel:{eventId:"",event:"",pageInfo:{},clickInfo:{}},ImpressionEventModel:{eventId:"",event:"",pageInfo:{},impressionInfo:[],isAdditiveView:!0},SearchEventModel:{eventId:"",event:"",pageInfo:{},pageSearchTerm:""}};function BaseProess(){InitbeanfunTrace(),SwitchSlot(),mainInfo.BGOTraceInfo.isH5&&(SetLoginStatus(),SetBfH5network(),SetBfH5DeviceInfo(),SetChangeBfH5APPVersion()),SetChangePageUrl(window.location.href.replace(window.location.search,""))}function InitbeanfunTrace(){try{var e;console.log("traceinit_start"),mainInfo.BGOTraceInfo.BUID||mainInfo.BGOTraceInfo.property||mainInfo.BGOTraceInfo.sourceProperty?sender=beanfunWebTraceSDK.init(mainInfo.BGOTraceInfo):(e="InitbeanfunTrace：參數未設定。",console.log(e),ErrorWrite(e,mainInfo.BGOTraceInfo))}catch(e){ErrorWrite(e,mainInfo.BGOTraceInfo)}console.log("traceinit_end")}function SetLoginStatus(){try{var e;TraceParams.LoginStatusModel.openId?(InitbeanfunTrace(),beanfunWebTraceSDK.status.setLoginStatus(TraceParams.LoginStatusModel)):(e="SetLoginStatus：參數未設定。",console.log(e),ErrorWrite(e,TraceParams.LoginStatusModel))}catch(e){ErrorWrite(e,TraceParams.LoginStatusModel)}}function SwitchSlot(){try{var e;TraceParams.SwitchSlotModel.experimentationInfo?(InitbeanfunTrace(),beanfunWebTraceSDK.status.switchSlot(TraceParams.SwitchSlotModel)):(e="SwitchSlot：參數未設定。",console.log(e),ErrorWrite(e,TraceParams.SwitchSlotModel))}catch(e){ErrorWrite(e,TraceParams.SwitchSlotModel)}}function SetBfH5network(){var e;TraceParams.BfH5networkInfo.network?(InitbeanfunTrace(),beanfunWebTraceSDK.status.setBfH5network(TraceParams.BfH5networkInfo)):(e="BfH5network：參數未設定。",console.log(e),ErrorWrite(e,TraceParams.BfH5networkInfo))}function SetBfH5DeviceInfo(){try{var e;TraceParams.BfH5DeviceInfo.deviceId||TraceParams.BfH5DeviceInfo.deviceModel||TraceParams.BfH5DeviceInfo.carrier||TraceParams.BfH5DeviceInfo.osName||TraceParams.BfH5DeviceInfo.osVersion?(InitbeanfunTrace(),beanfunWebTraceSDK.status.setBfH5DeviceInfo(TraceParams.BfH5DeviceInfo)):(e="SetBfH5DeviceInfo：參數未設定。",console.log(e),ErrorWrite(e,TraceParams.BfH5DeviceInfo))}catch(e){ErrorWrite(e,TraceParams.BfH5DeviceInfo)}}function SetChangeBfH5APPVersion(){try{var e;TraceParams.BfH5APPVersion.appVersion||TraceParams.BfH5APPVersion.appBuild?(InitbeanfunTrace(),beanfunWebTraceSDK.status.changeBfH5APPVersion(TraceParams.BfH5APPVersion)):(e="SetChangeBfH5APPVersion：參數未設定。",console.log(e),ErrorWrite(e,TraceParams.BfH5APPVersion))}catch(e){ErrorWrite(e,TraceParams.BfH5APPVersion)}}function SetChangePageUrl(a){try{var e;a?(TraceParams.BfH5PageUrl.pageUri=a,InitbeanfunTrace(),beanfunWebTraceSDK.status.changePageUrl(TraceParams.BfH5PageUrl)):(e="SetChangePageUrl：參數未設定。",console.log(e),ErrorWrite(e,a))}catch(e){ErrorWrite(e,a)}}var GetMemberProfile_Trace=new Promise((a,e)=>{try{var n;BGO?void 0!==BGO.init&&void 0!==BGO.get_me_profile?(n=beanfunInfo.Url.GameSyncUrl+"/V1.1/BeanGo/GetToken",mainInfo.IsIE?(HttpRequest("GET",n),BGO.init({token:data.ResultData.BGO_Token,official_account_id:data.ResultData.BGO_OfficialAccountID}),BGO.get_me_profile(function(e){TraceParams.BfH5DeviceInfo.osName=e.platform,TraceParams.BfH5DeviceInfo.osVersion=e.os_version,TraceParams.BfH5APPVersion.appVersion=e.app_version,a()})):Httpfetch("GET",n,null,function(e){BGO.init({token:e.ResultData.BGO_Token,official_account_id:e.ResultData.BGO_OfficialAccountID}),BGO.get_me_profile(function(e){TraceParams.BfH5DeviceInfo.osName=e.platform,TraceParams.BfH5DeviceInfo.osVersion=e.os_version,TraceParams.BfH5APPVersion.appVersion=e.app_version,a()})})):a():e()}catch(e){console.log("GetMemberProfile_Trace：未載入BGO SDK"),console.log(e.message),a()}}),Get_Encrypted_Open_Id=new Promise((a,e)=>{try{BGO?void 0!==BGO.get_encrypted_open_id?BGO.get_encrypted_open_id(function(e){TraceParams.LoginStatusModel.isLoggedIn=""!=e,TraceParams.LoginStatusModel.openId=e,beanfunInfo.TrackingSessiondata=e,a()}):a():e()}catch(e){console.log("Get_Encrypted_Open_Id：未載入BGO SDK"),console.log(e.message),a()}}),GetTrackingSessionData=new Promise((a,e)=>{try{BGO?void 0!==BGO.get_tracking_session_data?BGO.get_tracking_session_data(function(e){TraceParams.BfH5networkInfo.network=e.network_type,TraceParams.BfH5DeviceInfo.deviceId=e.device_id,TraceParams.BfH5DeviceInfo.deviceModel=e.device_model,TraceParams.BfH5APPVersion.appBuild=e.app_build,a()}):a():e()}catch(e){console.log("GetTrackingSessionData SDK"),console.log(e.message),a()}});function SenderEvent(e,a){try{var n=sender.passEvent(e);setTimeout(()=>CheckedResponseStatus(n,e,a),300)}catch(a){ErrorWrite(a,e)}}function SenderEvents(e,a){try{var n=sender.passEvent(e);setTimeout(()=>CheckedResponseStatus(n,param,a),300)}catch(a){ErrorWrite(a,e)}}function ErrorWrite(e,a){var n,t=window.location,r=beanfunInfo.Url.GameSyncUrl+"/V1/Log/Tyrannosaurus007";mainInfo.IsIE?HttpRequest("POST",r,n="Domain="+t.host+"&Page="+t.pathname+"&ErrorMsg="+e+"&SendParams="+JSON.stringify(a),0):((n=new URLSearchParams).append("Domain",t.host),n.append("Page",t.pathname),n.append("ErrorMsg",e),n.append("SendParams",JSON.stringify(a)),Httpfetch("POST",r,n))}function CheckedResponseStatus(e,a,n){var t;e&&(201===e.status||ErrorWrite(e,a)),n&&(t=(n.getAttribute("data-traceevent")?n:(n.parentNode.getAttribute("data-traceevent")?n:n.parentNode).parentNode).getAttribute("data-traceevent"),a=0<["poplinkclick","linkclick"].filter(e=>e==t).length,n&&a&&n.click())}function SetCookie(e,a,n){var t,r="";n&&((t=new Date).setTime(t.getTime()+24*n*60*60*1e3),r="; expires="+t.toUTCString()),document.cookie=e+"="+(a||"")+r+"; path=/"}function GetCookie(e){for(var a=e+"=",n=document.cookie.split(";"),t=0;t<n.length;t++){for(var r=n[t];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(a))return r.substring(a.length,r.length)}return null}var BaseInfoSetCookie=new Promise((e,a)=>{SetCookie(beanfunInfo.CookieKey,TraceParams,1),e()});function EventListenerHandle_Click(e){try{var a=e.target;if(!a)return;var n=a.parentElement;if(n.getAttribute("data-trace")&&n.getAttribute("data-traceevent"))a=n;else{var t=n.children;for(i=0;i<t.length;i++)if(t[i].getAttribute("data-trace")&&t[i].getAttribute("data-traceevent")){a=t[i];break}}var r=a.getAttribute("data-trace");if(r){var o=(o=a.getAttribute("data-traceevent")).toLowerCase();if(beanfunInfo.SendTraceName!=r){if(beanfunInfo.SendTraceName=r,"poplinkclick"!=o&&"linkclick"!=o||e.preventDefault(),o){var n="/"==(n=window.location.pathname)?"/Home/Index":n,c=TraceCodes[n];if(c){c=c[r];var s={};switch(InitbeanfunTrace(),c=addObjectPropertys(a,c),o){case"click":case"linkclick":case"poplinkclick":s=new beanfunWebTraceSDK.events.ClickEvent(c);break;case"search":s=new beanfunWebTraceSDK.events.SearchEvent(c)}SenderEvent(s,a)}}}else beanfunInfo.SendTraceName=""}}catch(e){}}function EventListenerHandle_NodeInserted(e){try{var a=e.target;if(!a)return;var n=a.parentElement;if(n.getAttribute("data-trace")&&n.getAttribute("data-traceevent"))a=n;else{var t=n.children;for(i=0;i<t.length;i++)if(t[i].getAttribute("data-trace")&&t[i].getAttribute("data-traceevent")){a=t[i];break}}var r=a.getAttribute("data-trace");r&&!a.getAttribute("data-traceevent")&&(beanfunInfo.SendTraceName!=r?(beanfunInfo.SendTraceName=r,console.log(e),n="/"==(n=window.location.pathname)?"/Home/Index":n,(n=(n=TraceCodes[n])&&n[r])&&(InitbeanfunTrace(),n=addObjectPropertys(a,n),SenderEvent(new beanfunWebTraceSDK.events.PageViewEvent(n)))):beanfunInfo.SendTraceName="")}catch(e){}}function SendPageView(e){var a,n="/"==(n=window.location.pathname)?"/Home/Index":n;e&&("undefined"!=typeof TraceCodes?(a=(a=TraceCodes[n])&&a[e])&&SenderEvent(new beanfunWebTraceSDK.events.PageViewEvent(a)):console.log("TraceCodes is not defined"))}function addObjectPropertys(e,a){var n=e.attributes;if(0<n.length)for(i=0;i<=n.length;i++){var t=n[i];if(t){var r=t.name.toLowerCase();if(-1<r.indexOf("clickinfo-")||-1<r.indexOf("pageinfo-")){r=r.split("-");if(1<r.length){var o="";switch(r[0]){case"clickinfo":o="clickInfo";break;case"pageinfo":o="pageInfo"}a[o]&&(a[o][r[1]]=t.value)}}}}return a}function HttpRequest(e,a,n,t){var r=!0,o={},i=new XMLHttpRequest;i.open(e,a);var c=n?n:null;return 0===t?i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):i.setRequestHeader("Content-Type","application/json"),i.send(c),"get"==e.toLowerCase()&&(200===i.status&&i.responseText?o=JSON.parse(i.responseText):r=!1,r||ErrorWrite("HttpRequest："+a,n)),o}function Httpfetch(e,a,n,t){var r={};switch(e.toLowerCase()){case"get":r={method:e};break;case"post":r={method:e,body:n}}fetch(a,r).then(e=>{t&&e.json().then(t)}).catch(e=>console.error("Error:",e))}